<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Football 1v1</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="topnav">
            <a href="index.html"><i class="fa fa-futbol"></i></a>
            <i class="fa-brands fa-bitcoin">
                <span class="cash"></span>
            </i>
            <i class="fa-solid fa-bars"></i>
        </div>

        <nav>
            <a href="1v1.html" class="active">1v1</a>
            <a href="quiz.html">Quiz</a>
        </nav>
    </header>

    <canvas id="canvas1"></canvas>

    <img id="player1" src="bilder/pelle.png">
    <img id="player2" src="bilder/pelle.png">
    <img id="ball" src="bilder/fotball.png">
    <img id="goal1" src="bilder/goal1.png">
    <img id="goal2" src="bilder/goal2.png">

    <!--<button id="skins">Buy Skins</button>-->

    <script src="script.js"></script>

    <script>
        window.addEventListener('load', function () {
            const canvas = document.getElementById('canvas1');
            const ctx = canvas.getContext('2d');
            canvas.width = 1300;
            canvas.height = 500;

            class Game {
                constructor(width, height) {
                    this.width = width;
                    this.height = height;
                    this.player1 = new Player1(this);
                    this.input = new InputHandler();
                    this.player2 = new Player2(this);
                    this.ball = new Ball(this);
                    this.goal1 = new Goal1(this);
                    this.goal2 = new Goal2(this);
                }

                update() {
                    this.player1.update(this.input.keys);
                    this.player2.update(this.input.keys);
                    this.ball.update();
                    collision(player1, player2)
                }

                draw(context) {
                    this.player1.draw(context);
                    this.player2.draw(context);
                    this.ball.draw(context);
                    this.goal1.draw(context);
                    this.goal2.draw(context);
                }
            }

            const game = new Game(canvas.width, canvas.height);
            console.log(game);

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                game.update();
                game.draw(ctx);
                requestAnimationFrame(animate);
            }
            animate();
        })

        class InputHandler {
            constructor() {
                this.keys = [];
                window.addEventListener('keydown', e => {
                    console.log(e.key, this.keys);
                    if ((e.key === 'ArrowDown' ||
                        e.key === 'ArrowUp' ||
                        e.key === 'ArrowLeft' ||
                        e.key === 'ArrowRight' ||
                        e.key === 'w' ||
                        e.key === 'a' ||
                        e.key === 'd' ||
                        e.key === 's' ||
                        e.key === 'e' ||
                        e.key === 'Space'
                    ) && this.keys.indexOf(e.key) === -1) {
                        this.keys.push(e.key);
                    }
                });
                window.addEventListener('keyup', e => {
                    if (e.key === 'ArrowDown' ||
                        e.key === 'ArrowUp' ||
                        e.key === 'ArrowLeft' ||
                        e.key === 'ArrowRight' ||
                        e.key === 'w' ||
                        e.key === 'a' ||
                        e.key === 'd' ||
                        e.key === 's' ||
                        e.key === 'e' ||
                        e.key === 'Space') {
                        this.keys.splice(this.keys.indexOf(e.key), 1);
                    }
                });
            }
        }




        class Player1 {
            constructor(game) {
                this.game = game;
                this.width = 57;
                this.height = 100;
                this.x = 743;
                this.y = this.game.height - this.height;
                this.vy = 0;
                this.weight = 1
                this.image = document.getElementById("player1")
                this.speed = 0;
                this.maxSpeed = 10;
            }

            update(input) {
                // horizontal movement
                this.x += this.speed;
                if (input.includes('ArrowRight')) this.speed = this.maxSpeed;
                else if (input.includes('ArrowLeft')) this.speed = -this.maxSpeed;
                else this.speed = 0;
                if (this.x < 0) this.x = 0;
                if (this.x > this.game.width - this.width) this.x = this.game.width - this.width;

                //vertical movement
                if (input.includes('ArrowUp') && this.onGround()) this.vy = -20;
                this.y += this.vy;
                if (!this.onGround()) this.vy += this.weight;
                else this.vy = 0;

                /*if (input.includes('Space')) {
                    if (this.ball.x < this.x + this.width &&
                        this.ball.x + this.width > this.x &&
                        this.ball.y < this.y + this.height &&
                        this.ball.y + this.height > this.y) {
                        this.vx = this.maxVx
                        this.vy = this.maxVy
                    }
                }

                if (player1.x < player2.x + player2.width &&
                    player1.x + player1.width > player2.x &&
                    player1.y < player2.y + player2.height &&
                    player1.y + player1.height > player2.y) {
                    player1.vx = 0
                    player2.vx = 0
                }*/
            }

            draw(context) {
                context.fillStyle = 'red'
                context.fillRect(this.x, this.y, this.width, this.height)
                context.drawImage(this.image, 0, 0, this.width, this.height, this.x, this.y, this.width, this.height)
            }

            onGround() {
                return this.y >= this.game.height - this.height;
            }
        }

        class Player2 {
            constructor(game) {
                this.game = game;
                this.width = 57;
                this.height = 100;
                this.x = 100;
                this.y = this.game.height - this.height;
                this.vy = 0;
                this.weight = 1
                this.image = document.getElementById("player2")
                this.speed = 0;
                this.maxSpeed = 10;
            }

            update(input) {
                // horizontal movement
                this.x += this.speed;
                if (input.includes('d')) this.speed = this.maxSpeed;
                else if (input.includes('a')) this.speed = -this.maxSpeed;
                else this.speed = 0;
                if (this.x < 0) this.x = 0;
                if (this.x > this.game.width - this.width) this.x = this.game.width - this.width;

                //vertical movement
                if (input.includes('w') && this.onGround()) this.vy = -20;
                this.y += this.vy;
                if (!this.onGround()) this.vy += this.weight;
                else this.vy = 0;

                /*if (player1.x < this.x + this.width &&
                    player1.x + player1.width > this.x &&
                    player1.y < this.y + this.height &&
                    player1.y + player1.height > this.y) {
                    this.vx = 0
                }*/
            }

            draw(context) {
                context.fillStyle = 'blue'
                context.fillRect(this.x, this.y, this.width, this.height)
                context.drawImage(this.image, 0, 0, this.width, this.height, this.x, this.y, this.width, this.height)
            }

            onGround() {
                return this.y >= this.game.height - this.height;
            }
        }

        class Ball {
            constructor(game, player1, player2) {
                this.player1 = player1
                this.player2 = player2
                this.game = game
                this.height = 40
                this.width = 40
                this.weight = 1
                this.x = (game.width / 2) - 20
                this.y = game.height - this.height * 2
                this.vx = 0
                this.vy = -8
                this.maxVy = 20
                this.gravity = 0.6
                this.xFriction = 1
                this.maxVx = 20
                this.bounce = 1
                this.image = document.getElementById("ball")
            }


            update() {
                this.x += this.vx
                this.y += this.vy
                this.vy += this.gravity

                if (this.x < 0) {
                    this.x = 0
                }
                if (this.x > this.game.width - this.width) {
                    this.x = this.game.width - this.width
                }

                // hvis ballen treffer vegg skal retning endres 
                if (this.x + this.radius > this.game.width || this.x - this.radius < 0) {
                    this.vx *= -1
                }

                if (this.y + this.radius > this.game.height) {
                    this.y = game.height - this.radius;
                    this.vy *= -this.bounce;

                    if (this.vy < 0 && this.vy > -8) {
                        this.vy = 0;
                    }

                    if (Math.abs(this.vx) < 1.1)
                        this.vx = 0;

                    if (this.vx > 0) {
                        this.vx = this.vx - this.xFriction
                    }
                    if (this.vx < 0) {
                        this.vx = this.vx + this.xFriction
                    }
                }

                if (this.x < (player1.x + player1.width) &&
                    this.x + this.width > player1.x &&
                    this.y < player1.y + player1.height &&
                    this.y + this.height > player1.y) {
                    this.vx = this.maxVx
                }

                // Sjekk kollisjon med player2
                if (this.x < player2.x + player2.width &&
                    this.x + this.width > player2.x &&
                    this.y < player2.y + player2.height &&
                    this.y + this.height > player2.y) {
                    // Behandle kollisjon med player2
                    this.vx = -5
                }

                if (!this.onGround()) this.vy += this.weight;
                else this.vy = 0;
            }

            draw(context) {
                context.fillStyle = "rgba(255, 255, 255, 0.01)"
                context.fillRect(this.x, this.y, this.width, this.height)
                context.drawImage(this.image, this.x, this.y, this.width, this.height)
            }

            onGround() {
                return this.y >= this.game.height - this.height;
            }
        }

        class Goal1 {
            constructor(game, ball) {
                this.game = game;
                this.ball = ball;
                this.height = 500;
                this.width = 200;
                this.x = -10;
                this.y = 142;
                this.image = document.getElementById('goal1');
            }

            draw(context) {
                context.fillStyle = "rgb(255,255,255, 0.1)";
                context.fillRect(this.x, this.y, this.width, this.height)
                context.drawImage(this.image, this.x, this.y, this.width, this.height)
            }
        }

        class Goal2 {
            constructor(game, ball) {
                this.game = game;
                this.ball = ball;
                this.height = 500;
                this.width = 200;
                this.x = 710;
                this.y = 142;
                this.image = document.getElementById("goal2");
            }

            draw(context) {
                context.fillStyle = "rgb(255,255,255, 0.1)";
                context.fillRect(this.x, this.y, this.width, this.height)
                context.drawImage(this.image, this.x, this.y, this.width, this.height)
            }
        }

        function collision(player1, player2){
            if (player1.x < player2.x + player2.width &&
                    player1.x + player1.width > player2.x &&
                    player1.y < player2.y + player2.height &&
                    player1.y + player1.height > player2.y) {
                    player1.vx = 0
                    player2.vx = 0
                }
        }
    </script>
</body>

</html>